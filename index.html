<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AQI Alarm</title>
    
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1C1C1E;
            --grouped-bg: #2C2C2E;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --accent-color: #0A84FF;
            --danger-color: #FF453A;
            --success-color: #30D158;
            --aqi-moderate: #FFD60A;
            --separator: #38383A;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Helvetica, Arial, sans-serif;
            margin: 0; padding: 0; height: 100vh; overflow: hidden; user-select: none;
        }

        .hidden { display: none !important; }

        /* --- SCREEN 1: HOME --- */
        #home-screen { height: 100%; display: flex; flex-direction: column; }

        .header { padding: 50px 20px 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .icon-btn { background: none; border: none; color: var(--accent-color); font-size: 24px; cursor: pointer; padding: 10px; }
        
        #aqi-area {
            flex: 3.5; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(180deg, #1c1c1e 0%, #000000 100%); border-bottom: 1px solid #333;
        }
        .aqi-value { font-size: 80px; font-weight: 700; color: var(--aqi-moderate); margin: 10px 0; line-height: 1; }
        .aqi-details { display: flex; gap: 20px; color: var(--text-secondary); font-size: 13px; }

        #alarms-area { flex: 6.5; padding: 20px; overflow-y: auto; }
        .section-title { font-size: 28px; font-weight: 700; margin-bottom: 20px; padding-left: 5px; }

        .alarm-container { position: relative; margin-bottom: 12px; height: 80px; border-radius: 16px; overflow: hidden; }
        .alarm-delete-bg {
            position: absolute; top: 0; bottom: 0; right: 0; width: 100%;
            background-color: var(--danger-color); display: flex; justify-content: flex-end; align-items: center;
            padding-right: 25px; font-weight: 600; color: white;
        }
        .alarm-row-content {
            position: relative; background-color: var(--card-bg); width: 100%; height: 100%; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
            transition: transform 0.2s ease-out; z-index: 2;
        }
        .alarm-info { display: flex; flex-direction: column; }
        .alarm-top-line { display: flex; align-items: baseline; gap: 10px; }
        .alarm-time { font-size: 26px; }
        .alarm-aqi-limit { font-size: 26px; color: var(--text-secondary); }
        .alarm-label { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }

        /* --- SCREEN 2: ADD ALARM --- */
        #add-alarm-screen { height: 100%; background-color: #000000; display: flex; flex-direction: column; }

        .modal-header {
            padding: 20px; padding-top: 50px; display: flex; justify-content: space-between;
            align-items: center; background-color: #1C1C1E;
        }
        .modal-title { font-size: 17px; font-weight: 600; }
        .modal-btn { background: none; border: none; font-size: 17px; color: var(--accent-color); cursor: pointer; }
        .modal-btn.save { font-weight: 600; }

        .time-picker-wrapper {
            background-color: #1C1C1E; padding: 40px 0; display: flex; justify-content: center; border-bottom: 1px solid #333;
        }
        input[type="time"] {
            background: none; border: none; color: white; font-size: 60px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-weight: 300; outline: none;
        }

        .settings-scroll-area { flex: 1; overflow-y: auto; padding: 20px; }
        .settings-group { background-color: var(--card-bg); border-radius: 12px; margin-bottom: 25px; overflow: hidden; }
        
        .settings-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid var(--separator); font-size: 17px;
            cursor: pointer; /* Indicates tappable */
        }
        .settings-row:last-child { border-bottom: none; }
        
        .row-label { color: white; }
        .row-value { color: var(--text-secondary); display: flex; align-items: center; gap: 10px; }
        
        .text-input {
            background: none; border: none; text-align: right; color: var(--text-secondary);
            font-size: 17px; outline: none; width: 150px;
        }
        .aqi-input {
            background: #2C2C2E; border: none; color: var(--accent-color);
            font-size: 17px; width: 60px; text-align: center; border-radius: 6px; padding: 5px;
        }
        .group-header {
            text-transform: uppercase; font-size: 13px; color: var(--text-secondary);
            margin-bottom: 8px; padding-left: 15px;
        }

        .switch { position: relative; display: inline-block; width: 50px; height: 30px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #3a3a3c; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(20px); }

    </style>
</head>
<body>

    <div id="home-screen">
        <div class="header">
            <button class="icon-btn" onclick="openSettings()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
            <button class="icon-btn" onclick="navToAddAlarm()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
        </div>

        <section id="aqi-area">
            <div class="aqi-location">Shanghai</div>
            <div class="aqi-value">85</div>
            <div style="font-size: 24px; color: var(--aqi-moderate); margin-bottom: 15px;">Moderate</div>
            <div class="aqi-details">
                <span>Major pollutant: PM2.5</span>
                <span>Last updated: 10:45 AM</span>
            </div>
        </section>

        <section id="alarms-area">
            <div class="section-title">Alarms</div>
            <div id="empty-state" class="empty-state" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:200px; color:gray;">
                <p>No alarms configured</p>
                <button onclick="navToAddAlarm()" style="background:#1C1C1E; color:#0A84FF; padding:10px 20px; border-radius:20px; border:none; margin-top:10px; cursor: pointer;">+ Add Alarm</button>
            </div>
            <div id="alarm-list-container" class="alarm-list"></div>
        </section>
    </div>

    <div id="add-alarm-screen" class="hidden">
        <div class="modal-header">
            <button class="modal-btn" onclick="navToHome()">Cancel</button>
            <span class="modal-title">Add Alarm</span>
            <button class="modal-btn save" onclick="saveNewAlarm()">Save</button>
        </div>

        <div class="time-picker-wrapper">
            <input type="time" id="new-alarm-time" value="07:00">
        </div>

        <div class="settings-scroll-area">
            
            <div class="settings-group">
                <div class="settings-row" onclick="cycleRepeat()">
                    <span class="row-label">Repeat</span>
                    <span class="row-value" id="disp-repeat">Never <span style="color: #444">></span></span>
                </div>
                
                <div class="settings-row">
                    <span class="row-label">Label</span>
                    <input type="text" id="new-alarm-label" class="text-input" placeholder="Alarm">
                </div>
                
                <div class="settings-row" onclick="cycleSound()">
                    <span class="row-label">Sound</span>
                    <span class="row-value" id="disp-sound">Radar <span style="color: #444">></span></span>
                </div>
                
                <div class="settings-row">
                    <span class="row-label">Snooze</span>
                    <label class="switch">
                        <input type="checkbox" id="new-alarm-snooze" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="group-header">Conditions</div>
            <div class="settings-group">
                <div class="settings-row">
                    <span class="row-label">Only if AQI is below</span>
                    <input type="number" id="new-alarm-aqi" class="aqi-input" value="100">
                </div>
                </div>
            
            <p style="text-align: center; color: #555; font-size: 12px; padding: 0 20px; margin-top: 20px;">
                The alarm will only sound if local air quality is better (lower) than the limit.
            </p>

        </div>
    </div>

    <script>
        // --- DATA STATE ---
        let alarms = []; 
        let tempSettings = {
            repeat: "Never",
            sound: "Radar"
        };
        const SOUND_OPTIONS = ["Radar", "Chime", "Silk", "Beacon"];
        const REPEAT_OPTIONS = ["Never", "Every Day", "Weekdays", "Weekends"];

        // --- NAVIGATION ---
        function navToAddAlarm() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('add-alarm-screen').classList.remove('hidden');
            
            // Reset form defaults
            document.getElementById('new-alarm-label').value = "";
            document.getElementById('new-alarm-aqi').value = "100";
            document.getElementById('new-alarm-snooze').checked = true;
            
            tempSettings.repeat = "Never";
            tempSettings.sound = "Radar";
            updateSettingsDisplay();
        }

        function navToHome() {
            document.getElementById('add-alarm-screen').classList.add('hidden');
            document.getElementById('home-screen').classList.remove('hidden');
        }

        // --- ADD ALARM LOGIC ---
        
        function cycleSound() {
            // Find current index, add 1, wrap around
            let idx = SOUND_OPTIONS.indexOf(tempSettings.sound);
            idx = (idx + 1) % SOUND_OPTIONS.length;
            tempSettings.sound = SOUND_OPTIONS[idx];
            updateSettingsDisplay();
        }

        function cycleRepeat() {
            let idx = REPEAT_OPTIONS.indexOf(tempSettings.repeat);
            idx = (idx + 1) % REPEAT_OPTIONS.length;
            tempSettings.repeat = REPEAT_OPTIONS[idx];
            updateSettingsDisplay();
        }

        function updateSettingsDisplay() {
            document.getElementById('disp-repeat').innerHTML = `${tempSettings.repeat} <span style="color: #444">></span>`;
            document.getElementById('disp-sound').innerHTML = `${tempSettings.sound} <span style="color: #444">></span>`;
        }

        function saveNewAlarm() {
            const timeVal = document.getElementById('new-alarm-time').value;
            let labelVal = document.getElementById('new-alarm-label').value;
            const aqiVal = document.getElementById('new-alarm-aqi').value;
            const snoozeVal = document.getElementById('new-alarm-snooze').checked;

            if (!labelVal) labelVal = "Alarm";

            alarms.push({
                time: timeVal,
                label: labelVal,
                aqiLimit: aqiVal,
                enabled: true,
                sound: tempSettings.sound,
                repeat: tempSettings.repeat,
                snooze: snoozeVal
            });

            renderAlarms();
            navToHome();
        }

        // --- HOME SCREEN LOGIC ---
        function renderAlarms() {
            const emptyState = document.getElementById('empty-state');
            const listContainer = document.getElementById('alarm-list-container');

            if (alarms.length === 0) {
                emptyState.style.display = 'flex';
                listContainer.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                listContainer.style.display = 'block';

                listContainer.innerHTML = alarms.map((alarm, index) => `
                    <div class="alarm-container">
                        <div class="alarm-delete-bg" onclick="deleteAlarm(${index})">Delete</div>
                        <div class="alarm-row-content" 
                             id="row-${index}"
                             ontouchstart="handleTouchStart(event, ${index})"
                             ontouchmove="handleTouchMove(event, ${index})"
                             ontouchend="handleTouchEnd(event, ${index})">
                            
                            <div class="alarm-info">
                                <div class="alarm-top-line">
                                    <span class="alarm-time">${alarm.time}</span>
                                    <span class="alarm-aqi-limit">AQI < ${alarm.aqiLimit}</span>
                                </div>
                                <span class="alarm-label">${alarm.label} ${alarm.repeat !== 'Never' ? 'â€¢ ' + alarm.repeat : ''}</span>
                            </div>
                            
                            <label class="switch">
                                <input type="checkbox" ${alarm.enabled ? 'checked' : ''} onchange="toggleAlarm(${index})">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                `).join('');
            }
        }

        function toggleAlarm(index) { alarms[index].enabled = !alarms[index].enabled; }

        function deleteAlarm(index) {
            if (confirm("Delete this alarm?")) {
                alarms.splice(index, 1);
                renderAlarms();
            } else { renderAlarms(); } // Reset swipe
        }

        // --- SWIPE LOGIC ---
        let startX = 0;
        let currentSwipeIndex = -1;
        function handleTouchStart(e, index) { startX = e.touches[0].clientX; currentSwipeIndex = index; }
        function handleTouchMove(e, index) {
            if (currentSwipeIndex !== index) return;
            const diff = e.touches[0].clientX - startX;
            const row = document.getElementById(`row-${index}`);
            if (diff < 0 && diff > -100) row.style.transform = `translateX(${diff}px)`;
        }
        function handleTouchEnd(e, index) {
            const diff = e.changedTouches[0].clientX - startX;
            const row = document.getElementById(`row-${index}`);
            if (diff < -80) row.style.transform = `translateX(-100px)`;
            else row.style.transform = `translateX(0px)`;
        }
        
        function openSettings() { alert("Global Settings \n(API Key, Units, etc.)"); }
        renderAlarms();
    </script>
</body>
</html>
